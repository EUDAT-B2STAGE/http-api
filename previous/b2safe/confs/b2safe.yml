
version: '3'
services:

  backend:
    environment:

      CELERY_ENABLE: ${SEADATA_PROJECT}
      CELERY_EXTERNAL: 1
      CELERY_BROKER: ${CELERY_BROKER}
      CELERY_BROKER_HOST: ${CELERY_BROKER_HOST}
      CELERY_BROKER_PORT: ${CELERY_BROKER_PORT}
      CELERY_BACKEND: ${CELERY_BACKEND}
      CELERY_BACKEND_HOST: ${CELERY_BACKEND_HOST}
      CELERY_BACKEND_PORT: ${CELERY_BACKEND_PORT}
      # SEADATA ELASTIC LOGS
      ELASTIC_ENABLE: ${SEADATA_PROJECT}
      ELASTIC_EXTERNAL: 1
      ELASTIC_HOST: ${ELASTIC_HOST}
      ELASTIC_PORT: ${ELASTIC_PORT}

  icat:
    build:
      context: ${SUBMODULE_DIR}/build-templates/b2safe
      # args:
      #   RAPYDO_VERSION: ${RAPYDO_VERSION}
    image: rapydo/b2safe:${RAPYDO_VERSION}
    environment:
      B2ACCESS_CAS: ${B2ACCESS_CAS}

    volumes:
      - ${SUBMODULE_DIR}/build-templates/b2safe/extra_b2access.sh:/docker-entrypoint.d/b2access.sh
      - ${SUBMODULE_DIR}/build-templates/b2safe/extra_b2safe.sh:/docker-entrypoint.d/b2safe.sh
      # B2ACCESS dev and prod certificates
      - ${SUBMODULE_DIR}/build-templates/b2safe/b2access_certificates:${B2ACCESS_CAS}
      # # Extra volumes
      # - /your/path/to/something:/var/lib/data/irods

    #Â Open irods port to Outside world
    ports:
        - 1247:1247
