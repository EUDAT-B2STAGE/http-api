9fdd72bc2ed60eb3ca186faaf50449c88c1f7bff diff --git a/do b/do index 31e3c71..7f3e549 100755 --- a/do +++ b/do @@ -16,6 +16,7 @@ backend_container="custombe" submodule_repo="backend" submodule_git="https://github.com/EUDAT-B2STAGE/http-api-base.git" services="$backend_container $fronted_container" +submodule_tracking="submodules.current.commit" ############################# echo "# ############################################ #" @@ -152,7 +153,7 @@ if [ "$2" == "init" ]; then #git@gitlab.hpc.cineca.it:mdantoni/telethon_repo.git echo "Download docker images" - $compose_com pull + $compose_com $files pull if [ ! -d "$submodule_repo" ]; then echo "Clone submodules" cd .. @@ -219,12 +220,40 @@ elif [ "$2" == "sql" ]; then echo "Launch adminer for SQL servers" $compose_com run --service-ports sqladmin +elif [ "$2" == "push" ]; then + + cd .. + echo "Pushing submodule" + cd $submodule_repo + git push + if [ $? != "0" ]; then + echo "Failed to push submodule" + exit 1 + fi + cd .. + + # Save a snapshot of current submodule + echo "Save submodule status" + echo -e \ + $(git show --pretty=%H)"
"$(git show-branch --current --no-color) \ + > $submodule_tracking + + echo "Pushing main repo" + git add $submodule_tracking + git commit && echo "Commit has been done" + + # Push to all repos setted + for repo in `git remote`; + do + git push $repo + done + + exit 0 + # Update repos, packages and images elif [ "$2" == "update" ]; then -# TO FIX: add custom compose here too - - $compose_com pull + $compose_com $files pull current=`pwd` cd .. @@ -240,6 +269,8 @@ elif [ "$2" == "update" ]; then cd $current $bcom + exit 0 + # Bower install elif [ "$2" == "bower" ]; then diff --git a/scripts/detached.sh b/scripts/detached.sh deleted file mode 100755 index a512947..0000000 --- a/scripts/detached.sh +++ /dev/null @@ -1,11 +0,0 @@ -#!/bin/bash - -branch='master' -tempbranch='recover' - -########## -git checkout -b $tempbranch -git branch -f $tempbranch $branch -git checkout $branch -git branch -d $tempbranch -git push origin $branch diff --git a/scripts/pull.sh b/scripts/pull.sh deleted file mode 100755 index c976cd8..0000000 --- a/scripts/pull.sh +++ /dev/null @@ -1,19 +0,0 @@ -#!/bin/bash - -services="backend" -#services="angulask rest-mock" -com="git" -pull="$com pull" - -$pull - -for service in $services; -do - echo "Repo '$service'" - $pull - git pull origin master -done - -# echo "Submodule sync" -# git submodule sync -# git submodule update diff --git a/scripts/push.sh b/scripts/push.sh deleted file mode 100755 index 03d6352..0000000 --- a/scripts/push.sh +++ /dev/null @@ -1,43 +0,0 @@ -#!/bin/bash - -services="backend" -#services="angulask rest-mock" -submodule_tracking="submodules.current.commit" - -########################################### -for service in $services; -do - echo "Repo '$service' push" - cd $service - # Push submodules - git push - # Interrupt if problems appear - if [ $? != "0" ]; then - echo "Failed" - exit 1 - fi - cd .. -done - -########################################### -# In case something has to be commited yet -# $com add $services -# $com add LICENSE README.md backend containers do docs frontend mkdocs.yml notebooks patches submodules.current.commit tasks tmp_graphdata vanilla - -# Save a snapshot of current submodule -echo "Save submodule status" -echo -e \ - $(git show --pretty=%H)"
"$(git show-branch --current --no-color) \ - > $submodule_tracking - -echo "Pushing main repo" -git add $submodule_tracking -git commit && echo "Commit has been done" - -########################################### -# Push to all repos setted - -for repo in `git remote`; -do - git push $repo -done
[master] Removing all scripts to use just one
