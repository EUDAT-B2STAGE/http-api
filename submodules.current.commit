bd9958157b9ee09bf40602bbb6a9b7d83709a1fc diff --git a/.gitignore b/.gitignore index 3e4daf2..19a7df9 100644 --- a/.gitignore +++ b/.gitignore @@ -1,4 +1,12 @@ +################ +# submodules + +# rest-mock +backend + +################ + # user custom configs vanilla/specs/api_init.json vanilla/specs/js_init.json diff --git a/scripts/boot.sh b/scripts/boot.sh index a5d209b..4b78fc6 100755 --- a/scripts/boot.sh +++ b/scripts/boot.sh @@ -26,11 +26,14 @@ bcom="$com run $webbuild bower install" # First time install if [ "$1" == "init" ]; then +git add private http://130.186.13.81:10080/pdonorio/restangulask.git + echo "Download docker images" docker-compose pull - echo "Download submodules" - git submodule init - git submodule update + echo "Clone submodules" + git clone https://github.com/pdonorio/rest-mock.git backend + # git submodule init + # git submodule update echo "Build bower packages" $bcom echo "Completed" @@ -43,6 +46,10 @@ elif [ "$1" == "update" ]; then docker-compose pull current=`pwd` cd .. + + echo "Pulling main repo" + git pull + for service in $services; do echo "Repo '$service' fetch" @@ -50,8 +57,11 @@ elif [ "$1" == "update" ]; then git pull cd .. done - git submodule sync - git submodule update + + # git submodule sync + # git submodule update + + echo "Updating libs" cd $current $bcom diff --git a/scripts/push.sh b/scripts/push.sh index e852b7d..36cc04b 100755 --- a/scripts/push.sh +++ b/scripts/push.sh @@ -2,9 +2,7 @@ services="backend" #services="angulask rest-mock" -com="git" -push="$com push origin" -#push="$com push origin master" +submodule_tracking="submodules.current.commit" ########################################### for service in $services; @@ -12,7 +10,7 @@ do echo "Repo '$service' push" cd $service # Push submodules - $push + git push # Interrupt if problems appear if [ $? != "0" ]; then echo "Failed" @@ -28,11 +26,21 @@ $com add $services if [ "$1" == "quick" ];then $com commit -m 'Submodules updates' else - $com commit + + # Save a snapshot of current submodule + echo "Save submodule status" + echo -e \ + $(git show --pretty=%H)"
"$(git show-branch --current --no-color) \ + > $submodule_tracking + + echo "Pushing main repo" + git add $submodule_tracking + git commit && git push && echo "Completed" fi ########################################### # Original repo $push + # Private repo $com push private master diff --git a/submodules.current.commit b/submodules.current.commit new file mode 100644 index 0000000..d774419 --- /dev/null +++ b/submodules.current.commit @@ -0,0 +1,2 @@ +a080d25d184777ed111461bf5acdfa5ec23a32f1 diff --git a/.gitmodules b/.gitmodules index 68b4293..e69de29 100644 --- a/.gitmodules +++ b/.gitmodules @@ -1,4 +0,0 @@ -[submodule "backend"] - path = backend - url = git@github.com:pdonorio/rest-mock.git - branch = master \ No newline at end of file diff --git a/backend b/backend deleted file mode 160000 index 7ac6a9a..0000000 --- a/backend +++ /dev/null @@ -1 +0,0 @@ -Subproject commit 7ac6a9a27fbc2fff0932bdfee82230d1e441f166 +[master] Removed submodule rest-mock
[master] Changing scripts accordingly to the rule 'no more submodules'
