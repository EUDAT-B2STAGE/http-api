
services:

  icat:
    environment:
      ACTIVATE: 1
      POSTGRES_HOST: "${ALCHEMY_HOST}"
      POSTGRES_USER: "${ALCHEMY_USER}"
      POSTGRES_PASSWORD: "${ALCHEMY_PASSWORD}"
      IRODS_HOST: "${IRODS_HOST}"
      IRODS_PORT: ${IRODS_PORT}
      IRODS_ZONE: ${IRODS_ZONE}
      IRODS_DB: "${IRODS_DB}"
      IRODS_USER: ${IRODS_USER}
      IRODS_PASSWORD: ${IRODS_PASSWORD}
      B2ACCESS_CAS: ${B2ACCESS_CAS}

    volumes:
      - etcconf:/etc
      - irodshome:/home/${IRODS_USER}
      - irodsvar:/var/lib/${IRODS_USER}
      - sharedcerts:/opt/certificates
      # NOTE: this is the script that adds GSI in our irods instance
      - ../submodules/builds_base/icat/extra_b2access.sh:/docker-entrypoint.d/b2access.sh
      - ../submodules/builds_base/icat/extra_b2safe.sh:/docker-entrypoint.d/b2safe.sh
      # # B2ACCESS dev and prod certificates
      - ../submodules/builds_base/icat/b2access_certificates:${B2ACCESS_CAS}
      # # B2ACCESS dev rest-of-the-chain certificates
      # - ../data/certs:/usr/local/share/ca-certificates

    # Open irods port to Outside world
    ports:
        - 1247:1247
